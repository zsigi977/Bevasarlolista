<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Bev√°s√°rl√≥lista</title>

    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lista">

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="shortcut icon" href="icon.png">
    
    <style>
        /* Alap testreszab√°s √©s h√°tt√©r */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: url('hatter.png') repeat center center;
            background-size: auto;
            color: #000;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        h1 { text-align: center; margin-top: 10px; }

        /* √úvegkont√©ner */
        #login-section, #app {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            width: 100%;
            max-width: 400px;
        }

        .controls { display: flex; gap: 10px; margin-bottom: 15px; }
        select, input, button { padding: 12px; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; outline: none; }
        input { background: white; -webkit-appearance: none; }
        input:focus { border-color: #007aff; }
        button { cursor: pointer; background: #fff; transition: opacity 0.2s; }
        button:active { opacity: 0.7; }
        .btn-primary { background: #007aff; color: white; border: none; font-weight: 600; }
        ul { list-style: none; padding: 0; }
        li { background: white; padding: 14px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .left { display: flex; align-items: center; gap: 12px; font-size: 17px; }
        .checked { text-decoration: line-through; color: #8e8e93; }
        .delete { background: none; border: none; font-size: 20px; color: #ff3b30; padding: 5px; }
        #login-form { display: flex; flex-direction: column; gap: 12px; }
        .logout-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: rgba(229, 229, 234, 0.7); padding: 8px 12px; border-radius: 10px; font-size: 13px; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
    </style>
</head>
<body>

<div id="login-section">
    <h1>üõí Lista</h1>
    <div id="login-form">
        <input type="text" id="usernameInput" placeholder="Felhaszn√°l√≥n√©v" autocorrect="off" autocapitalize="none" />
        <input type="password" id="passInput" placeholder="Jelsz√≥" />
        <button id="loginBtn" class="btn-primary">Bel√©p√©s</button>
        <p id="error" style="color:#ff3b30; font-size: 14px; margin-top: 10px;"></p>
    </div>
</div>

<div id="app" style="display:none;">
    <div class="logout-container">
        <span id="user-display"></span>
        <button id="logoutBtn">Kijelentkez√©s</button>
    </div>
    
    <h1>Bev√°s√°rl√≥lista</h1>
    
    <div class="controls">
        <input type="text" id="itemInput" placeholder="√öj term√©k..." style="flex: 1;" />
        <button id="addBtn" class="btn-primary">‚ûï</button>
    </div>

    <div class="controls">
        <select id="storeSelect" style="flex: 1;">
            <option value="aldi">Aldi</option>
            <option value="lidl">Lidl</option>
            <option value="spar">Spar</option>
        </select>
        <button id="clearBtn">üóëÔ∏è</button>
    </div>

    <ul id="list"></ul>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCslE4Kc229j41Sm2l7ovpc_KEWhOb107k",
        authDomain: "bevasarlolista-dd660.firebaseapp.com",
        databaseURL: "https://bevasarlolista-dd660-default-rtdb.firebaseio.com",
        projectId: "bevasarlolista-dd660",
        storageBucket: "bevasarlolista-dd660.firebasestorage.app",
        messagingSenderId: "482885096675",
        appId: "1:482885096675:web:f569deb724cb835358e1d6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const itemsRef = ref(db, 'items');

    let items = [];

    const storeOrders = {
        aldi: ["k√°v√©","tea","lekv√°r","nutella","mogyor√≥vaj","gabonapehely","keksz","csoki","gumicukor","√©dess√©g","r√°gcsa","snack","chips","mogyor√≥","ban√°n","alma","narancs","citrom","v√©rnarancs","sz≈ël≈ë","gy√ºm√∂lcs","mandarin","gomba","krumpli","bor","feh√©rbor","v√∂r√∂sbor","vodka","gagyi vodka","gagyivodka","pezsg≈ë","s√∂r","mosogat√≥g√©p s√≥","√∂bl√≠t≈ë","mos√≥szer","v√≠zk≈ëold√≥","szemeteszs√°k","kuk√°szs√°k","kukazs√°k","tiszt√≠t√≥szer","mosogat√≥g√©p kapszula","tusf√ºrd≈ë","sampon","vattapamacs","fogkefe","fogkr√©m","dezodor","hagyma","fokhagyma","paparika","paradicsom","√∫jhagyma","t√∂k","lilahagyma","r√©pa","levesz√∂lsd√©g","zeller","passata","paradicsomp√ºr√©","paradicsom p√ºr√©","paprikakr√©m","kukorica","konzerv kukorica","kukorica konzerv","saviubi","savany√∫ uborka","paprikakr√©m","paprika kr√©m","guly√°skr√©m","olivbogy√≥","olivabogy√≥","t√©szta","mamat√©szta","mama t√©szta","szarvacska","spagetti","farfelle","penne","rizs","rizsa","tarhonya","cica kaja","pamacskaja","macska kaja","macskakaja","macska alom","macskaalom","cica alom","cicaalom","olaj","olivaolaj","oliva olaj","liszt","s√≥","cukor","barna cukor","van√≠li√°s cukor","aroma","van√≠lia aroma","rum aroma","citroml√©","limel√©","mirelit","mirelit bors√≥","bors√≥","mirelit kukorica","mirelit brokkoli","brokkoli","z√∂ldbab","mirelit z√∂ldbab","mexik√≥i","vegyes z√∂lsd√©g","mirelit z√∂lds√©g","h√∫s","csirkecomb","csirke comb","comb","sert√©s comb","karaj","tarja","oldalas","sz≈±z","hal","lazac","leves mix","levesmix","m√°j","kolb√°sz","sz√°razkolb√°sz","sz√°raz kolb√°sz","szalonna","kolozsv√°ri szalonna","cs√°sz√°r szalonna","kolozsv√°riszalonna","cs√°sz√°rszalonna","felv√°gott","sonka","szal√°mi","virsli","f≈±szerek","oreg√°no","kakukkf≈±","majoranna","bors","tarkabors","sz√≠nesbors","kapor","fokhagymapor","fokhagyma por","fokhagymagranul√°tum","fokhagyma granul√°tum","leveskocka","ketchup","kecsap","majon√©z","must√°r","sajt","kem√©nysajt","lapka sajt","lapkasajt","parmez√°n","grana padano","sajtkr√©m","sajt kr√©m","kr√©msajt","tejf√∂l","joghurt","tej","tejsz√≠n","tejsz√≠nhab","toj√°s","keny√©r","kifli","zsemle","tortilla","p√©ks√ºti","p√©kcucc","s√ºti","√ºccsi","√ºd√≠t≈ë","k√≥la","cola","narancsl√©","gy√ºm√∂lcsle","gy√ºmil√©","gy√∂mb√©r","sz√∂rp","pink tonik","pinktonik","pink tonic","tej"],
        lidl: ["z√∂lds√©g", "gy√ºm√∂lcs", "keny√©r", "tej", "toj√°s"],
        spar: ["tej", "keny√©r", "toj√°s", "z√∂lds√©g", "gy√ºm√∂lcs"]
    };

    function normalize(text) {
        if (!text) return "";
        return text.toString().toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    // --- AUTH LOGIKA ---
    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById("login-section").style.display = "none";
            document.getElementById("app").style.display = "block";
            document.getElementById("user-display").textContent = "Szia, " + (user.email ? user.email.split('@')[0] : "Felhaszn√°l√≥");
            loadData();
        } else {
            document.getElementById("login-section").style.display = "block";
            document.getElementById("app").style.display = "none";
        }
    });

    window.login = async function() {
        const user = document.getElementById("usernameInput").value.trim().toLowerCase();
        const pass = document.getElementById("passInput").value;
        const errorP = document.getElementById("error");

        if(!user || !pass) {
            errorP.textContent = "T√∂ltsd ki mindk√©t mez≈ët!";
            return;
        }

        const fakeEmail = user + "@lista.hu";
        try {
            await signInWithEmailAndPassword(auth, fakeEmail, pass);
            errorP.textContent = "";
        } catch (err) {
            errorP.textContent = "Hiba: Rossz n√©v vagy jelsz√≥!";
        }
    };

    window.logout = () => signOut(auth);

    // --- LISTA KEZEL√âSE ---
    function loadData() {
        onValue(itemsRef, (snapshot) => {
            items = snapshot.val() || [];
            render();
        });
    }

    function save() {
        set(itemsRef, items);
    }

    window.addItem = function() {
        const input = document.getElementById("itemInput");
        const val = input.value.trim();
        if (!val) return;
        
        items.push({ id: Date.now(), name: val, checked: false });
        input.value = "";
        window.sortItems(); 
    };

window.toggle = (id) => {
        const item = items.find(i => i.id === id);
        if (item) { 
            item.checked = !item.checked;
            
            // Azonnali ment√©s - a Firebase onValue friss√≠t√©se fogja √∫jrarajzolni
            set(itemsRef, items);
        }
    };

    window.removeItem = (id) => {
        items = items.filter(i => i.id !== id);
        save();
    };

    window.clearList = () => {
        if (confirm("T√∂rl√∂d a teljes list√°t?")) { 
            items = []; 
            save(); 
        }
    };

window.sortItems = () => {
        const store = document.getElementById("storeSelect").value;
        const order = storeOrders[store] || [];
        
        items.sort((a, b) => {
            // 1. El≈ësz√∂r a "pipa" √°llapot szerint rendez√ºnk (a hamis/0 ker√ºl el≈ëre, az igaz/1 h√°tra)
            if (a.checked !== b.checked) {
                return a.checked ? 1 : -1;
            }

            // 2. Ha az √°llapotuk azonos, akkor j√∂n a bolti sorrend
            const ai = order.map(normalize).indexOf(normalize(a.name));
            const bi = order.map(normalize).indexOf(normalize(b.name));
            const posA = ai === -1 ? 999 : ai;
            const posB = bi === -1 ? 999 : bi;
            
            return posA - posB;
        });
        save();
    };

function render() {
        const ul = document.getElementById("list");
        ul.innerHTML = "";
        
        // Itt is megh√≠vjuk a rendez√©st, hogy a pipa ut√°n azonnal √°thelyezze
        const store = document.getElementById("storeSelect").value;
        const order = storeOrders[store] || [];
        
        const sortedItems = [...items].sort((a, b) => {
            if (a.checked !== b.checked) return a.checked ? 1 : -1;
            const ai = order.map(normalize).indexOf(normalize(a.name));
            const bi = order.map(normalize).indexOf(normalize(b.name));
            return (ai === -1 ? 999 : ai) - (bi === -1 ? 999 : bi);
        });

        sortedItems.forEach(item => {
            const li = document.createElement("li");
            const icon = item.checked ? "‚úÖ" : "‚ö™"; 
            
            li.innerHTML = `
                <div class="left" onclick="window.toggle(${item.id})" style="cursor: pointer; display: flex; align-items: center; gap: 15px; flex: 1;">
                    <span style="font-size: 24px; min-width: 30px; user-select: none;">${icon}</span>
                    <span class="${item.checked ? 'checked' : ''}" style="font-size: 18px; user-select: none;">${item.name}</span>
                </div>
                <button class="delete" onclick="window.removeItem(${item.id})" style="padding: 10px;">üóëÔ∏è</button>
            `;
            ul.appendChild(li);
        });
    }

    // Esem√©nykezel≈ëk
    document.getElementById("loginBtn").addEventListener("click", window.login);
    document.getElementById("logoutBtn").addEventListener("click", window.logout);
    document.getElementById("addBtn").addEventListener("click", window.addItem);
    document.getElementById("clearBtn").addEventListener("click", window.clearList);
    document.getElementById("storeSelect").addEventListener("change", window.sortItems);
    document.getElementById("itemInput").addEventListener("keypress", (e) => {
        if (e.key === "Enter") window.addItem();
    });

</script>
</body>
</html>
