<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Bev√°s√°rl√≥lista</title>

    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lista">

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="shortcut icon" href="icon.png">
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: url('hatter.png') repeat center center;
            background-size: auto;
            margin: 0; padding: 20px; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        #login-section, #app {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px; padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            width: 90%; max-width: 400px;
            margin-top: 20px;
            position: relative;
            z-index: 10;
        }

        h1 { text-align: center; margin-bottom: 20px; font-size: 24px; color: #1c1c1e; }
        .controls { display: flex; gap: 10px; margin-bottom: 15px; position: relative; }
        
        input[type="text"], input[type="password"], select { 
            padding: 12px; border-radius: 10px; border: 1px solid #ccc; 
            font-size: 16px; outline: none; background: #fff !important;
            color: #000; width: 100%; box-sizing: border-box;
            -webkit-appearance: none;
        }

        button { padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-size: 16px; transition: opacity 0.2s; }
        button:active { opacity: 0.7; }
        .btn-primary { background: #007aff; color: white; font-weight: 600; }
        
        #custom-suggestions {
            position: absolute;
            top: 50px; left: 0;
            width: calc(100% - 55px);
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .suggestion-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 16px; }
        .suggestion-item:active { background: #f0f0f0; }

        ul { list-style: none; padding: 0; margin-top: 10px; }
        li { 
            background: white; padding: 12px; border-radius: 12px; 
            display: flex; align-items: center; margin-bottom: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .drag-handle { cursor: grab; padding: 0 10px; color: #bbb; font-size: 20px; user-select: none; }
        .checked { text-decoration: line-through; color: #8e8e93 !important; }
        .qty-tag { color: #007aff; font-weight: bold; margin-right: 5px; font-size: 14px; }
        .delete { background: none; font-size: 20px; color: #ff3b30; margin-left: auto; padding: 5px; }
        
        .logout-container { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 15px; background: rgba(0,0,0,0.05); 
            padding: 8px 12px; border-radius: 10px; font-size: 14px;
        }
    </style>
</head>
<body>

<div id="login-section">
    <h1>üõí Lista</h1>
    <div id="login-form">
        <input type="text" id="usernameInput" placeholder="Felhaszn√°l√≥n√©v" autocorrect="off" autocapitalize="none" />
        <input type="password" id="passInput" placeholder="Jelsz√≥" />
        <button id="loginBtn" class="btn-primary">Bel√©p√©s</button>
        <p id="error" style="color:#ff3b30; font-size: 14px; margin-top: 10px; text-align: center;"></p>
    </div>
</div>

<div id="app" style="display:none;">
    <div class="logout-container">
        <span id="user-display"></span>
        <button id="logoutBtn">Kil√©p√©s</button>
    </div>
    
    <h1>Bev√°s√°rl√≥lista</h1>
    
    <div class="controls">
        <input type="text" id="itemInput" placeholder="Pl: 2 tej vagy 0.5 kg keny√©r" autocomplete="off" />
        <div id="custom-suggestions"></div>
        <button id="addBtn" class="btn-primary">‚ûï</button>
    </div>

    <div class="controls">
        <select id="storeSelect">
            <option value="aldi">Aldi</option>
            <option value="penny">Penny</option>
            <option value="spar">Spar</option>
        </select>
        <button id="clearBtn">üóëÔ∏è</button>
    </div>

    <ul id="list"></ul>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCslE4Kc229j41Sm2l7ovpc_KEWhOb107k",
        authDomain: "bevasarlolista-dd660.firebaseapp.com",
        databaseURL: "https://bevasarlolista-dd660-default-rtdb.firebaseio.com",
        projectId: "bevasarlolista-dd660",
        storageBucket: "bevasarlolista-dd660.firebasestorage.app",
        messagingSenderId: "482885096675",
        appId: "1:482885096675:web:f569deb724cb835358e1d6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const itemsRef = ref(db, 'items');

    let items = [];
    let sortable = null;
    let allProductDatabase = [];

 const storeOrders = {
        aldi: ["k√°v√©","kaka√≥","tea","m√©z","lekv√°r","nutella","mogyor√≥vaj","gabonapehely","keksz","dar√°lt keksz","csoki","gumicukor","√©dess√©g","r√°gcsa","snack","chips","popcorn","aszalt gy√ºm√∂lcs","mogyor√≥","t√∂kmag","ban√°n","alma","k√∂rte","narancs","citrom","v√©rnarancs","sz≈ël≈ë","gy√ºm√∂lcs","mandarin","gomba","krumpli","bor","feh√©rbor","v√∂r√∂sbor","vodka","gagyi vodka","gagyivodka","pezsg≈ë","s√∂r","mosogat√≥g√©p s√≥","√∂bl√≠t≈ë","mos√≥szer","v√≠zk≈ëold√≥","zs√≠rold√≥","wc g√©l","szivacs","szemeteszs√°k","aluf√≥lia","folpakk","univerz√°lis tiszt√≠t√≥","pap√≠rt√∂rl≈ë","wcpap√≠r","wc pap√≠r","kuk√°szs√°k","kukazs√°k","tiszt√≠t√≥szer","mosogat√≥g√©p kapszula","tusf√ºrd≈ë","sampon","vattapamacs","fogkefe","fogkr√©m","dezodor","hagyma","fokhagyma","paprika","paradicsom","√∫jhagyma","t√∂k","lilahagyma","p√≥r√©hagyma","kelk√°poszta","k√°poszta","k√≠gy√≥ uborka","r√©pa","feh√©r r√©pa","cukkini","padlizs√°n","levesz√∂lsd√©g","zeller","sz√°lzeller","passata","matymaty","ketchup","bbq sz√≥sz","sz√≥jasz√≥sz","worchester sz√≥sz","√©des chili sz√≥sz","kecsap","majon√©z","must√°r","paradicsomp√ºr√©","paradicsom p√ºr√©","paprikakr√©m","kukorica","konzerv kukorica","melegszendvics kr√©m","kukorica konzerv","bab","bab konzerv","saviubi","savany√∫ uborka","paprikakr√©m","paprika kr√©m","guly√°skr√©m","olivbogy√≥","olivabogy√≥","t√©szta","mamat√©szta","mama t√©szta","szarvacska","spagetti","bet≈±t√©szta","csigat√©szta","c√©rnamet√©lt","farfelle","penne","rizs","rizsa","tarhonya","cica kaja","pamacskaja","macska kaja","macskakaja","macska alom","macskaalom","cica alom","cicaalom","olaj","olivaolaj","oliva olaj","ecet","liszt","kem√©ny√≠t≈ë","pr√©zli","b√∫zadara","gr√≠z","zsemlemorzsa","s√≥","cukor","barna cukor","porcukor","van√≠li√°s cukor","k√≥kusz reszel√©k","k√≥kuszreszel√©k","puding","van√≠lia puding","csoki puding","sz√≥dabikarb√≥na","s√ºt≈ëpor","aroma","van√≠lia aroma","rum aroma","citroml√©","limel√©","mirelit","mirelit bors√≥","fagyi","j√©gkr√©m","s√ºltkrumpli","steak krumpli","bors√≥","mirelit kukorica","mirelit brokkoli","brokkoli","z√∂ldbab","mirelit z√∂ldbab","mexik√≥i","vegyes z√∂lsd√©g","mirelit z√∂lds√©g","h√∫s","dar√°lth√∫s","sert√©s-marha mix","csirkecomb","csirkesz√°rny","csirke comb","comb","sert√©s comb","h√∫sos csont","lapocka","dar√°lt lapocka","karaj","tarja","oldalas","sz≈±z","hal","sushi","lazac","leves mix","levesmix","m√°j","kolb√°sz","sz√°razkolb√°sz","sz√°raz kolb√°sz","szalonna","savany√∫ k√°poszta","kolozsv√°ri szalonna","cs√°sz√°r szalonna","kolozsv√°riszalonna","cs√°sz√°rszalonna","felv√°gott","bacon","sonka","szal√°mi","virsli","f≈±szerek","levesgy√∂ngy","bab√©rlev√©l","fah√©j","szerecsendi√≥","f≈±szerpaprika","gy√∂mb√©r","oreg√°no","petrezselyem","bazsalikom","kakukkf≈±","majoranna","rozmaring","k√∂m√©ny","csirkef≈±szer","f≈±szerk√∂m√©ny","pirospaprika","f√ºst√∂ltpaprika","f√ºst√∂lt paprika","bors","tarkabors","sz√≠nesbors","feh√©rbors","feh√©r bors","kapor","fokhagymapor","fokhagyma por","fokhagymagranul√°tum","fokhagyma granul√°tum","szez√°mmag","leveskocka","sajt","kem√©nysajt","lapka sajt","vaj","margarin","lapkasajt","parmez√°n","grana padano","sajtkr√©m","sajt kr√©m","kr√©msajt","tejf√∂l","joghurt","g√∂r√∂gjoghurt","tej","tejsz√≠n","tejsz√≠nhab","cukr√°szhab","toj√°s","keny√©r","kifli","zsemle","tortilla","p√©ks√ºti","p√©kcucc","s√ºti","√ºccsi","√ºd√≠t≈ë","k√≥la","cola","narancsl√©","gy√ºm√∂lcsle","gy√ºmil√©","gy√∂mb√©r √ºd√≠t≈ë","sz√∂rp","pink tonik","pinktonik","pink tonic","tej"],
        penny: ["mogyor√≥","t√∂kmag","aszalt gy√ºm√∂lcs","ban√°n","k√∂rte","alma","narancs","citrom","v√©rnarancs","sz≈ël≈ë","gy√ºm√∂lcs","mandarin","gomba","krumpli","hagyma","fokhagyma","paprika","paradicsom","√∫jhagyma","t√∂k","lilahagyma","p√≥r√©hagyma","r√©pa","feh√©r r√©pa","k√°poszta","kelk√°poszta","cukkini","padlizs√°n","savany√∫ k√°poszta","k√≠gy√≥ uborka","levesz√∂lsd√©g","zeller","sz√°lzeller","toj√°s","gabonapehely","lekv√°r","nutella","m√©z","k√°v√©","kaka√≥","tea","citroml√©","limel√©","keksz","dar√°lt keksz","csoki","gumicukor","√©dess√©g","r√°gcsa","snack","chips","popcorn","√ºccsi","√ºd√≠t≈ë","k√≥la","cola","narancsl√©","gy√ºm√∂lcsle","gy√ºmil√©","gy√∂mb√©r √ºd√≠t≈ë","sz√∂rp","pink tonik","pinktonik","pink tonic","bor","feh√©rbor","v√∂r√∂sbor","vodka","gagyi vodka","gagyivodka","pezsg≈ë","s√∂r","t√©szta","mamat√©szta","mama t√©szta","szarvacska","spagetti","bet≈±t√©szta","csigat√©szta","c√©rnamet√©lt","farfelle","penne","rizs","rizsa","tarhonya","f≈±szerek","levesg√∂ngy","fah√©j","szerecsendi√≥","bab√©rlev√©l","f≈±szerpaprika","gy√∂mb√©r","oreg√°no","petrezselyem","bazsalikom","kakukkf≈±","majoranna","rozmaring","k√∂m√©ny","csirkef≈±szer","f≈±szerk√∂m√©ny","pirospaprika","f√ºst√∂ltpaprika","f√ºst√∂lt paprika","bors","tarkabors","sz√≠nesbors","feh√©rbors","feh√©r bors","kapor","fokhagymapor","fokhagyma por","fokhagymagranul√°tum","fokhagyma granul√°tum","szez√°mmag","keny√©r","kifli","zsemle","tortilla","p√©ks√ºti","p√©kcucc","s√ºti","olaj","olivaolaj","oliva olaj","ecet","passata","paradicsomp√ºr√©","paradicsom p√ºr√©","paprikakr√©m","ketchup","kecsap","bbq sz√≥sz","sz√≥jasz√≥sz","worchester sz√≥sz","√©des chili sz√≥sz","majon√©z","must√°r","kukorica","konzerv kukorica","kukorica konzerv","bab","bab konzerv","melegszendvics kr√©m","saviubi","savany√∫ uborka","mogyor√≥vaj","paprikakr√©m","paprika kr√©m","guly√°skr√©m","olivbogy√≥","olivabogy√≥","sajt","vaj","margarin","kem√©nysajt","lapka sajt","lapkasajt","parmez√°n","grana padano","sajtkr√©m","sajt kr√©m","kr√©msajt","tejf√∂l","joghurt","g√∂r√∂gjoghurt","tej","tejsz√≠n","tejsz√≠nhab","cukr√°szhab","liszt","kem√©ny√≠t≈ë","s√≥","cukor","barna cukor","pr√©zli","b√∫zadara","gr√≠z","zsemlemorzsa","van√≠li√°s cukor","k√≥kusz reszel√©k","k√≥kuszreszel√©k","porcukor","puding","van√≠lia puding","csoki puding","sz√≥dabikarb√≥na","s√ºt≈ëpor","aroma","van√≠lia aroma","rum aroma","h√∫s","dar√°lth√∫s","sert√©s-marha mix","csirkecomb","csirkesz√°rny","csirke comb","comb","sert√©s comb","h√∫sos csont","lapocka","dar√°lt lapocka","karaj","tarja","oldalas","sz≈±z","hal","sushi","lazac","leves mix","levesmix","m√°j","kolb√°sz","sz√°razkolb√°sz","sz√°raz kolb√°sz","szalonna","kolozsv√°ri szalonna","cs√°sz√°r szalonna","kolozsv√°riszalonna","cs√°sz√°rszalonna","felv√°gott","bacon","sonka","szal√°mi","virsli","leveskocka","mirelit","fagyi","j√©gkr√©m","mirelit bors√≥","s√ºltkrumpli","steak krumpli","bors√≥","mirelit kukorica","mirelit brokkoli","brokkoli","z√∂ldbab","mirelit z√∂ldbab","mexik√≥i","vegyes z√∂lsd√©g","mirelit z√∂lds√©g","mosogat√≥g√©p s√≥","√∂bl√≠t≈ë","mos√≥szer","szivacs","v√≠zk≈ëold√≥","zs√≠rold√≥","wc g√©l","szemeteszs√°k","aluf√≥lia","folpakk","univerz√°lis tiszt√≠t√≥","pap√≠rt√∂rl≈ë","wcpap√≠r","wc pap√≠r","kuk√°szs√°k","kukazs√°k","tiszt√≠t√≥szer","mosogat√≥g√©p kapszula","tusf√ºrd≈ë","sampon","vattapamacs","fogkefe","fogkr√©m","dezodor","cica kaja","pamacskaja","macska kaja","macskakaja","macska alom","macskaalom","cica alom","cicaalom"],
        spar: ["mogyor√≥","t√∂kmag,"aszalt gy√ºm√∂lcs","ban√°n","alma","k√∂rte","narancs","citrom","v√©rnarancs","sz≈ël≈ë","gy√ºm√∂lcs","mandarin","gomba","krumpli","hagyma","fokhagyma","paprika","paradicsom","√∫jhagyma","t√∂k","lilahagyma","p√≥r√©hagyma","r√©pa","feh√©r r√©pa","cukkini","padlizs√°n","k√°poszta","kelk√°poszta","savany√∫ k√°poszta","k√≠gy√≥ uborka","levesz√∂lsd√©g","zeller","sz√°lzeller","toj√°s","sajt","kem√©nysajt","lapka sajt","lapkasajt","vaj","margarin","parmez√°n","grana padano","sajtkr√©m","sajt kr√©m","kr√©msajt","tejf√∂l","joghurt","g√∂r√∂gjoghurt","tej","tejsz√≠n","tejsz√≠nhab","cukr√°szhab","liszt","kem√©ny√≠t≈ë","s√≥","cukor","porcukor","barna cukor","pr√©zli","b√∫zadara","gr√≠z","zsemlemorzsa","k√°v√©","kaka√≥","tea","m√©z","citroml√©","limel√©","gabonapehely","keksz","dar√°lt keksz","csoki","gumicukor","√©dess√©g","r√°gcsa","snack","chips","popcorn","van√≠li√°s cukor","k√≥kusz reszel√©k","k√≥kuszreszel√©k","puding","van√≠lia puding","csoki puding","sz√≥dabikarb√≥na","s√ºt≈ëpor","aroma","van√≠lia aroma","rum aroma","keny√©r","kifli","zsemle","tortilla","p√©ks√ºti","p√©kcucc","s√ºti","olaj","olivaolaj","oliva olaj","ecet","passata","paradicsomp√ºr√©","paradicsom p√ºr√©","paprikakr√©m","ketchup","kecsap","bbq sz√≥sz","sz√≥jasz√≥sz","worchester sz√≥sz","√©des chili sz√≥sz","majon√©z","must√°r","kukorica","konzerv kukorica","kukorica konzerv","bab","bab konzerv","melegszendvics kr√©m","saviubi","savany√∫ uborka","lekv√°r","nutella","mogyor√≥vaj","paprikakr√©m","paprika kr√©m","guly√°skr√©m","olivbogy√≥","olivabogy√≥","t√©szta","mamat√©szta","mama t√©szta","szarvacska","spagetti","bet≈±t√©szta","csigat√©szta","c√©rnamet√©lt","farfelle","penne","rizs","rizsa","tarhonya","levesgy√∂ngy","f≈±szerek","bab√©rlev√©l","fah√©j","f≈±szerpaprika","gy√∂mb√©r","oreg√°no","petrezselyem","bazsalikom","kakukkf≈±","majoranna","rozmaring","k√∂m√©ny","szerecsendi√≥","csirkef≈±szer","f≈±szerk√∂m√©ny","pirospaprika","f√ºst√∂ltpaprika","f√ºst√∂lt paprika","bors","tarkabors","feh√©rbors","feh√©r bors","sz√≠nesbors","kapor","fokhagymapor","fokhagma por","fokhagymagranul√°tum","fokhagyma granul√°tum","szez√°mmag","h√∫s","dar√°lth√∫s","sert√©s-marha mix","csirkecomb","csirkesz√°rny","csirke comb","comb","sert√©s comb","h√∫sos csont","lapocka","dar√°lt lapocka","karaj","tarja","oldalas","sz≈±z","hal","sushi","lazac","leves mix","levesmix","m√°j","kolb√°sz","sz√°razkolb√°sz","sz√°raz kolb√°sz","szalonna","kolozsv√°ri szalonna","cs√°sz√°r szalonna","kolozsv√°riszalonna","cs√°sz√°rszalonna","felv√°gott","bacon","sonka","szal√°mi","virsli","leveskocka","√ºccsi","√ºd√≠t≈ë","k√≥la","cola","narancsl√©","gy√ºm√∂lcsle","gy√ºmil√©","gy√∂mb√©r √ºd√≠t≈ë","sz√∂rp","pink tonik","pinktonik","pink tonic","bor","feh√©rbor","v√∂r√∂sbor","vodka","gagyi vodka","gagyivodka","pezsg≈ë","s√∂r","mirelit","fagyi","j√©gkr√©m","mirelit bors√≥","s√ºltkrumpli","steak krumpli","bors√≥","mirelit kukorica","mirelit brokkoli","brokkoli","z√∂ldbab","mirelit z√∂ldbab","mexik√≥i","vegyes z√∂lsd√©g","mirelit z√∂lds√©g","mosogat√≥g√©p s√≥","√∂bl√≠t≈ë","mos√≥szer","v√≠zk≈ëold√≥","szivacs","zs√≠rold√≥","wc g√©l","szemeteszs√°k","aluf√≥lia","folpakk","univerz√°lis tiszt√≠t√≥","pap√≠rt√∂rl≈ë","wcpap√≠r","wc pap√≠r","kuk√°szs√°k","kukazs√°k","tiszt√≠t√≥szer","mosogat√≥g√©p kapszula","tusf√ºrd≈ë","sampon","vattapamacs","fogkefe","fogkr√©m","dezodor","cica kaja","pamacskaja","macska kaja","macskakaja","macska alom","macskaalom","cica alom","cicaalom"],
    };

    function normalize(text) {
        if (!text) return "";
        return text.toString().toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    function initDatabase() {
        const allProducts = new Set();
        Object.values(storeOrders).forEach(list => list.forEach(item => allProducts.add(item)));
        allProductDatabase = Array.from(allProducts).sort();
    }

    function updateSuggestions(searchValue) {
        const container = document.getElementById("custom-suggestions");
        container.innerHTML = "";
        
        let term = normalize(searchValue);
        const match = term.match(/^[\d.,/ ]*(db|kg|l|liter|g|cs)?\s*(.*)$/i);
        if (match && match[2]) term = match[2];

        if (term.length < 2) {
            container.style.display = "none";
            return;
        }

        const filtered = allProductDatabase.filter(p => normalize(p).includes(term));
        
        if (filtered.length > 0) {
            container.style.display = "block";
            filtered.slice(0, 10).forEach(product => {
                const div = document.createElement("div");
                div.className = "suggestion-item";
                div.textContent = product;
                div.onclick = () => {
                    const currentVal = document.getElementById("itemInput").value;
                    const qMatch = currentVal.match(/^([\d.,/ ]+(db|kg|l|liter|g|cs)?\s*)/i);
                    const prefix = qMatch ? qMatch[1] : "";
                    
                    document.getElementById("itemInput").value = prefix + product;
                    container.style.display = "none";
                    window.addItem();
                };
                container.appendChild(div);
            });
        } else {
            container.style.display = "none";
        }
    }

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById("login-section").style.display = "none";
            document.getElementById("app").style.display = "block";
            document.getElementById("user-display").textContent = "Szia, " + user.email.split('@')[0];
            initDatabase();
            loadData();
        } else {
            document.getElementById("login-section").style.display = "block";
            document.getElementById("app").style.display = "none";
        }
    });

    window.login = async function() {
        const user = document.getElementById("usernameInput").value.trim().toLowerCase();
        const pass = document.getElementById("passInput").value;
        if(!user || !pass) return;
        try {
            await signInWithEmailAndPassword(auth, user + "@lista.hu", pass);
        } catch (err) { document.getElementById("error").textContent = "Hiba: Rossz n√©v vagy jelsz√≥!"; }
    };

    window.logout = () => signOut(auth);

    function loadData() {
        onValue(itemsRef, (snapshot) => {
            items = snapshot.val() || [];
            render();
        });
    }

    window.addItem = function() {
        const input = document.getElementById("itemInput");
        let val = input.value.trim();
        if (!val) return;

        const quantityMatch = val.match(/^([\d.,/ ]+(db|kg|l|liter|g|cs)?)\s+(.*)$/i);
        let quantity = "";
        let itemName = val;

        if (quantityMatch) {
            quantity = quantityMatch[1].trim(); 
            itemName = quantityMatch[3].trim(); 
        }

        // DUPLIK√ÅCI√ì ELLEN≈êRZ√âSE: ha m√°r van ilyen n√©vvel t√©tel, csak t√∂r√∂lj√ºk az inputot √©s kil√©p√ºnk
        const isDuplicate = items.some(item => normalize(item.name) === normalize(itemName));
        if (isDuplicate) {
            input.value = "";
            document.getElementById("custom-suggestions").style.display = "none";
            return;
        }

        items.push({ 
            id: Date.now(), 
            name: itemName, 
            qty: quantity,
            checked: false 
        });

        input.value = "";
        document.getElementById("custom-suggestions").style.display = "none";
        window.sortItems();
    };

    window.toggle = (id) => {
        const item = items.find(i => i.id === id);
        if (item) {
            item.checked = !item.checked;
            window.sortItems();
        }
    };

    window.removeItem = (id) => {
        items = items.filter(i => i.id !== id);
        set(itemsRef, items);
    };

    window.clearList = () => {
        if (confirm("T√∂rl√∂d a teljes list√°t?")) { items = []; set(itemsRef, items); }
    };

    window.sortItems = () => {
        const store = document.getElementById("storeSelect").value;
        const order = storeOrders[store] || [];
        items.sort((a, b) => {
            if (a.checked !== b.checked) return a.checked ? 1 : -1;
            const ai = order.map(normalize).indexOf(normalize(a.name));
            const bi = order.map(normalize).indexOf(normalize(b.name));
            const posA = ai === -1 ? 999 : ai;
            const posB = bi === -1 ? 999 : bi;
            return posA - posB;
        });
        set(itemsRef, items);
    };

    function render() {
        const ul = document.getElementById("list");
        ul.innerHTML = "";
        items.forEach(item => {
            const li = document.createElement("li");
            li.dataset.id = item.id;
            li.innerHTML = `
                <div class="drag-handle">‚ò∞</div>
                <div style="flex:1; display:flex; align-items:center; gap:8px; cursor:pointer;" onclick="window.toggle(${item.id})">
                    <span style="font-size:22px;">${item.checked ? "‚úÖ" : "‚ö™"}</span>
                    <span class="${item.checked ? 'checked' : ''}">
                        ${item.qty ? `<span class="qty-tag">${item.qty}</span>` : ''} 
                        ${item.name}
                    </span>
                </div>
                <button class="delete" onclick="window.removeItem(${item.id})">üóëÔ∏è</button>
            `;
            ul.appendChild(li);
        });

        if (sortable) sortable.destroy();
        sortable = Sortable.create(ul, {
            handle: '.drag-handle',
            animation: 150,
            onEnd: () => {
                const newOrder = [];
                ul.querySelectorAll('li').forEach(el => {
                    const id = parseInt(el.dataset.id);
                    const item = items.find(i => i.id === id);
                    if(item) newOrder.push(item);
                });
                items = newOrder;
                set(itemsRef, items);
            }
        });
    }

    document.getElementById("loginBtn").onclick = window.login;
    document.getElementById("usernameInput").onkeypress = (e) => { if(e.key === "Enter") document.getElementById("passInput").focus(); };
    document.getElementById("passInput").onkeypress = (e) => { if(e.key === "Enter") window.login(); };
    document.getElementById("logoutBtn").onclick = window.logout;
    document.getElementById("addBtn").onclick = window.addItem;
    document.getElementById("clearBtn").onclick = window.clearList;
    document.getElementById("storeSelect").onchange = window.sortItems;

    const itemInput = document.getElementById("itemInput");
    itemInput.oninput = (e) => updateSuggestions(e.target.value);
    itemInput.onkeypress = (e) => { if(e.key === "Enter") window.addItem(); };

    document.addEventListener("click", (e) => {
        if (e.target.id !== "itemInput") {
            document.getElementById("custom-suggestions").style.display = "none";
        }
    });
</script>
</body>
</html>
