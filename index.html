<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bev√°s√°rl√≥lista</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f2f2f7; color: #000; margin: 0; padding: 20px; min-height: 100vh; }
        h1 { text-align: center; }
        .controls { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        select, input, button { padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
        button { cursor: pointer; background: #fff; }
        .btn-primary { background: #007aff; color: white; border: none; }
        ul { list-style: none; padding: 0; }
        li { background: white; padding: 12px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .left { display: flex; align-items: center; gap: 10px; }
        .checked { text-decoration: line-through; color: gray; }
        .delete { background: none; border: none; font-size: 18px; color: red; }
        #login-form { max-width: 300px; margin: 50px auto; display: flex; flex-direction: column; gap: 10px; }
        .logout-container { text-align: right; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="login-section" style="display: block;">
    <div id="login-form">
        <h2>Bel√©p√©s</h2>
        <input type="email" id="emailInput" placeholder="Email c√≠m" />
        <input type="password" id="passInput" placeholder="Jelsz√≥" />
        <button id="loginBtn" class="btn-primary">Bel√©p√©s</button>
        <p id="error" style="color:red; font-size: 14px;"></p>
    </div>
</div>

<div id="app" style="display:none;">
    <div class="logout-container">
        <small id="user-email"></small>
        <button id="logoutBtn" style="padding: 5px 10px; font-size: 12px;">Kijelentkez√©s</button>
    </div>
    
    <h1>üõí Bev√°s√°rl√≥lista</h1>
    
    <div class="controls">
        <input type="text" id="itemInput" placeholder="√öj term√©k" style="flex: 1;" />
        <button id="addBtn" class="btn-primary">‚ûï</button>
    </div>

    <div class="controls">
        <select id="storeSelect" style="flex: 1;">
            <option value="aldi">Aldi</option>
            <option value="lidl">Lidl</option>
            <option value="spar">Spar</option>
        </select>
        <button id="clearBtn">üóëÔ∏è T√∂rl√©s</button>
    </div>

    <ul id="list"></ul>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCslE4Kc229j41Sm2l7ovpc_KEWhOb107k",
        authDomain: "bevasarlolista-dd660.firebaseapp.com",
        projectId: "bevasarlolista-dd660",
        storageBucket: "bevasarlolista-dd660.firebasestorage.app",
        messagingSenderId: "482885096675",
        appId: "1:482885096675:web:f569deb724cb835358e1d6",
        measurementId: "G-C6LVZZB2EF"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const itemsRef = ref(db, 'items');

    let items = [];

    // --- AUTHENTICATION LOGIC ---

    // Bejelentkez√©s figyel√©se (ha m√°r be van l√©pve, ne k√©rje √∫jra)
    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById("login-section").style.display = "none";
            document.getElementById("app").style.display = "block";
            document.getElementById("user-email").textContent = user.email;
            loadData();
        } else {
            document.getElementById("login-section").style.display = "block";
            document.getElementById("app").style.display = "none";
        }
    });

    window.login = async function() {
        const email = document.getElementById("emailInput").value;
        const pass = document.getElementById("passInput").value;
        const errorP = document.getElementById("error");

        try {
            await signInWithEmailAndPassword(auth, email, pass);
            errorP.textContent = "";
        } catch (err) {
            errorP.textContent = "Hiba: Rossz email vagy jelsz√≥!";
            console.error(err);
        }
    };

    window.logout = function() {
        signOut(auth);
    };

    // --- SHOPPING LIST LOGIC ---

    function loadData() {
        onValue(itemsRef, (snapshot) => {
            const data = snapshot.val();
            items = data || [];
            render();
        });
    }

    function saveToFirebase() {
        set(itemsRef, items);
    }

    window.addItem = function() {
        const input = document.getElementById("itemInput");
        const value = input.value.trim();
        if (!value) return;
        
        items.push({ id: Date.now(), name: value, checked: false });
        input.value = "";
        window.sortItems();
    };

    window.toggle = function(id) {
        const item = items.find(i => i.id === id);
        if (item) {
            item.checked = !item.checked;
            saveToFirebase();
        }
    };

    window.removeItem = function(id) {
        items = items.filter(i => i.id !== id);
        saveToFirebase();
    };

    window.clearList = function() {
        if (confirm("Biztos t√∂rl√∂d?")) {
            items = [];
            saveToFirebase();
        }
    };

    window.sortItems = function() {
        // ... (A kor√°bbi rendez√©si logik√°d v√°ltozatlan)
        saveToFirebase();
    };

    function render() {
        const ul = document.getElementById("list");
        ul.innerHTML = "";
        items.forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `
                <div class="left">
                    <input type="checkbox" ${item.checked ? 'checked' : ''} onclick="toggle(${item.id})">
                    <span class="${item.checked ? 'checked' : ''}">${item.name}</span>
                </div>
                <button class="delete" onclick="removeItem(${item.id})">üóëÔ∏è</button>
            `;
            ul.appendChild(li);
        });
    }

    // Esem√©nykezel≈ëk
    document.getElementById("loginBtn").onclick = window.login;
    document.getElementById("logoutBtn").onclick = window.logout;
    document.getElementById("addBtn").onclick = window.addItem;
    document.getElementById("clearBtn").onclick = window.clearList;
    document.getElementById("itemInput").onkeypress = (e) => e.key === "Enter" && window.addItem();

</script>
</body>
</html>
